<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wordify Round Example</title>
  <!-- Load the bundled CSS -->
  <link rel="stylesheet" href="../dist/wordify-ui.css">
</head>
<body>
  <div id="game-container"></div>

  <!-- Load the UMD bundle -->
  <script src="../dist/wordify.umd.js"></script>
  <script>
    // Check if Wordify loaded correctly
    if (typeof Wordify === 'undefined') {
      console.error('Wordify failed to load - check that dist/wordify.umd.js exists');
      document.body.innerHTML = '<h1>Error: Wordify library not loaded</h1><p>Run "npm run build" first, then serve this file with a local server (e.g., "npx serve .")</p>';
      throw new Error('Wordify not loaded');
    }
    console.log('Wordify loaded:', Object.keys(Wordify));
  </script>
  <script>
    // Tile values for English locale
    const tileValues = {
      A: 1, B: 3, C: 3, D: 2, E: 1, F: 4, G: 2, H: 4, I: 1, J: 8,
      K: 5, L: 1, M: 3, N: 1, O: 1, P: 3, Q: 10, R: 1, S: 1, T: 1,
      U: 1, V: 4, W: 4, X: 8, Y: 4, Z: 10
    };

    // Helper to place tiles on a board string
    // Position is { x: 1-15 (column), y: 1-15 (row) }
    function placeTiles(tiles) {
      const board = new Array(225).fill('');
      for (const { x, y, letter } of tiles) {
        // Convert to index: column-major order
        const index = (x - 1) * 15 + (y - 1);
        board[index] = letter;
      }
      return board.join(',');
    }

    // Word "HELLO" at row 8, starting at column 6
    const boardString = placeTiles([
      { x: 6, y: 8, letter: 'H' },
      { x: 7, y: 8, letter: 'E' },
      { x: 8, y: 8, letter: 'L' },
      { x: 9, y: 8, letter: 'L' },
      { x: 10, y: 8, letter: 'O' }
    ]);

    // Create the initial game state using the new initialization format
    const initialState = {
      myPlayerNumber: 0,
      playerToMove: 0,
      players: [
        { name: 'You', score: 24, endBonus: undefined, connected: true, lastSeen: undefined },
        { name: 'Alice', score: 32, endBonus: undefined, connected: true, lastSeen: undefined },
        { name: 'Bob', score: 18, endBonus: undefined, connected: false, lastSeen: Date.now() - 300000 }
      ],
      moveHistory: [
        {
          type: 'boardMove',
          playerIndex: 1,
          overallScore: 32,
          wordsMade: [{ word: 'HELLO', score: 32 }]
        },
        {
          type: 'pass',
          playerIndex: 2
        }
      ],
      tilesRemaining: 82,
      potentialScore: null,
      lastMoveReceived: Date.now(),
      chatMessages: [
        { type: 'message', user: 'Alice', message: 'Good luck everyone!' },
        { type: 'message', user: 'Bob', message: "Let's have fun!" }
      ],
      lastChatMessageReceived: 2,
      lastDefinitionReceived: 0,
      rack: [
        { type: 'letter', letter: 'W', value: 4 },
        { type: 'letter', letter: 'O', value: 1 },
        { type: 'letter', letter: 'R', value: 1 },
        { type: 'letter', letter: 'D', value: 2 },
        { type: 'blank', assigned: null },
        { type: 'letter', letter: 'I', value: 1 },
        { type: 'letter', letter: 'N', value: 1 }
      ],
      // Use the standard board layout exported by the library
      boardLayout: Wordify.BOARD_LAYOUT,
      // Board string: comma-delimited, column-major order
      boardString: boardString,
      gameEnded: false,
      tileValues: tileValues
    };

    // Sample notifications: two unread + one read, so the highlight difference is visible
    const sampleNotifications = [
      {
        notificationId: '1',
        notificationCreatedAt: Date.now() - 5 * 60000, // 5 minutes ago
        notificationReadAt: undefined, // unread — bold text, blue border, blue dot
        notificationDetails: {
          type: 'gameInvite',
          inviteFromUser: 'Alice',
          gameLobbyId: 'lobby-abc-123'
        },
        url: '/games/lobby-abc-123/invite'
      },
      {
        notificationId: '2',
        notificationCreatedAt: Date.now() - 30 * 60000, // 30 minutes ago
        notificationReadAt: undefined, // unread
        notificationDetails: {
          type: 'gameInvite',
          inviteFromUser: 'Bob',
          gameLobbyId: 'lobby-def-456'
        },
        url: '/games/lobby-def-456/invite'
      },
      {
        notificationId: '3',
        notificationCreatedAt: Date.now() - 5 * 3600000, // 5 hours ago
        notificationReadAt: Date.now() - 4 * 3600000, // read 4 hours ago — dimmed, no border
        notificationDetails: {
          type: 'gameInvite',
          inviteFromUser: 'Carol',
          gameLobbyId: 'lobby-ghi-789'
        },
        url: '/games/lobby-ghi-789/invite'
      }
    ];

    // Mount the Wordify game using the options object format
    const game = Wordify.createRound('#game-container', {
      initialState: initialState,
      isLoggedIn: true,
      notifications: sampleNotifications
      // websocketUrl: 'wss://example.com/game/123'  // Uncomment to connect to a websocket
    });

    // Monitor connection state:
    // game.connectionState.value // 'disconnected', 'connecting', 'connected', or 'error'

    // Connect to websocket later (if not provided in options):
    // game.connect('wss://example.com/game/123');

    // Disconnect from websocket:
    // game.disconnect();

    // Update state manually (e.g., for testing without websocket):
    // game.updateState(newState);

    // Clean up when done (also disconnects websocket):
    // game.unmount();

    console.log('Wordify round mounted successfully!');
  </script>
</body>
</html>
