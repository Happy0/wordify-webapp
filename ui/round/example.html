<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wordify Library Example</title>
  <!-- Load the bundled CSS -->
  <link rel="stylesheet" href="./dist/wordify-ui.css">
</head>
<body>
  <div id="game-container"></div>

  <!-- Load the UMD bundle -->
  <script src="./dist/wordify.umd.js"></script>
  <script>
    // Check if Wordify loaded correctly
    if (typeof Wordify === 'undefined') {
      console.error('Wordify failed to load - check that dist/wordify.umd.js exists');
      document.body.innerHTML = '<h1>Error: Wordify library not loaded</h1><p>Run "npm run build" first, then serve this file with a local server (e.g., "npx serve .")</p>';
      throw new Error('Wordify not loaded');
    }
    console.log('Wordify loaded:', Object.keys(Wordify));
  </script>
  <script>
    // Create the initial game state using the new initialization format
    const initialState = {
      myPlayerNumber: 0,
      playerToMove: 0,
      players: [
        { name: 'You', score: 24, endBonus: undefined, connected: true, lastSeen: undefined },
        { name: 'Alice', score: 32, endBonus: undefined, connected: true, lastSeen: undefined },
        { name: 'Bob', score: 18, endBonus: undefined, connected: false, lastSeen: Date.now() - 300000 }
      ],
      moveHistory: [
        {
          type: 'boardMove',
          playerIndex: 1,
          overallScore: 32,
          wordsMade: [{ word: 'HELLO', score: 32 }]
        },
        {
          type: 'pass',
          playerIndex: 2
        }
      ],
      tilesRemaining: 82,
      potentialScore: null,
      lastMoveReceived: Date.now(),
      chatMessages: [
        { type: 'message', user: 'Alice', message: 'Good luck everyone!' },
        { type: 'message', user: 'Bob', message: "Let's have fun!" }
      ],
      lastChatMessageReceived: 2,
      lastDefinitionReceived: 0,
      rack: [
        { type: 'letter', letter: 'W', value: 4 },
        { type: 'letter', letter: 'O', value: 1 },
        { type: 'letter', letter: 'R', value: 1 },
        { type: 'letter', letter: 'D', value: 2 },
        { type: 'blank', assigned: null },
        { type: 'letter', letter: 'I', value: 1 },
        { type: 'letter', letter: 'N', value: 1 }
      ],
      // Use the standard board layout exported by the library
      boardLayout: Wordify.BOARD_LAYOUT,
      // Sparse array of tiles already placed on the board (positions are 1-based)
      // Word "HELLO" at row 8, starting at column 6
      placedTiles: [
        { position: { x: 6, y: 8 }, tile: { type: 'letter', letter: 'H', value: 4 } },
        { position: { x: 7, y: 8 }, tile: { type: 'letter', letter: 'E', value: 1 } },
        { position: { x: 8, y: 8 }, tile: { type: 'letter', letter: 'L', value: 1 } },
        { position: { x: 9, y: 8 }, tile: { type: 'letter', letter: 'L', value: 1 } },
        { position: { x: 10, y: 8 }, tile: { type: 'letter', letter: 'O', value: 1 } }
      ],
      gameEnded: false
    };

    // Mount the Wordify game using the options object format
    const game = Wordify.createWordify('#game-container', {
      initialState: initialState
      // websocketUrl: 'wss://example.com/game/123'  // Uncomment to connect to a websocket
    });

    // Monitor connection state:
    // game.connectionState.value // 'disconnected', 'connecting', 'connected', or 'error'

    // Connect to websocket later (if not provided in options):
    // game.connect('wss://example.com/game/123');

    // Disconnect from websocket:
    // game.disconnect();

    // Update state manually (e.g., for testing without websocket):
    // game.updateState(newState);

    // Clean up when done (also disconnects websocket):
    // game.unmount();

    console.log('Wordify game mounted successfully!');
  </script>
</body>
</html>
